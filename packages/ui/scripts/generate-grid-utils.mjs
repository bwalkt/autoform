import { writeFileSync } from 'node:fs'
import { resolve } from 'node:path'

const breakpoints = {
  xs: 520,
  sm: 768,
  md: 1024,
  lg: 1280,
  xl: 1640,
}

const buildCols = (prefix, count, noneLabel) => {
  const lines = []
  for (let i = 1; i <= count; i += 1) {
    lines.push(`.${prefix}-${i} {`)
    lines.push(`  grid-template-columns: repeat(${i}, minmax(0, 1fr));`)
    lines.push(`}`)
  }
  lines.push(`.${prefix}-${noneLabel} {`)
  lines.push(`  grid-template-columns: none;`)
  lines.push(`}`)
  return lines
}

const buildRows = (prefix, count, noneLabel) => {
  const lines = []
  for (let i = 1; i <= count; i += 1) {
    lines.push(`.${prefix}-${i} {`)
    lines.push(`  grid-template-rows: repeat(${i}, minmax(0, 1fr));`)
    lines.push(`}`)
  }
  lines.push(`.${prefix}-${noneLabel} {`)
  lines.push(`  grid-template-rows: none;`)
  lines.push(`}`)
  return lines
}

const lines = [
  '/* Generated by scripts/generate-grid-utils.mjs */',
  '',
  ...buildCols('rt-grid-cols', 12, 'none'),
  '',
  ...buildRows('rt-grid-rows', 6, 'none'),
  '',
]

for (const [bp, width] of Object.entries(breakpoints)) {
  lines.push(`@media (min-width: ${width}px) {`)
  lines.push(...buildCols(`rt-grid-cols-${bp}`, 12, 'none').map(line => `  ${line}`))
  lines.push('')
  lines.push(...buildRows(`rt-grid-rows-${bp}`, 6, 'none').map(line => `  ${line}`))
  lines.push(`}`)
  lines.push('')
}

const outputPath = resolve(process.cwd(), 'packages/ui/src/layouts/grid-utils.css')
writeFileSync(outputPath, `${lines.join('\n')}\n`)
